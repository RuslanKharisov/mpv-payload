Техническое задание: Система онбординга поставщиков (OnStock B2B)
1. Цель проекта
Создать интуитивно понятный пошаговый процесс (Wizard) для новых поставщиков, который позволит им активировать свой профиль и запустить поиск по своим товарам, не прибегая к стандартной админ-панели PayloadCMS.
2. Основная концепция (UX)
Вместо сложного заполнения таблиц БД, поставщик проходит через 3-4 простых шага.
Главное разделение: Поставщик сам выбирает уровень интеграции:
Light (Google Sheets): Быстрый запуск поиска по внешней таблице (Remote Stock).
Full (Native Inventory): Полноценное управление складом, остатками и ценами внутри OnStock (Local Stock).
3. Структура процесса (Steps)
Шаг 1: Профиль компании (Tenant Identity)
Задача: Создать или обновить сущность Tenant.
Поля: Название компании, Логотип, Публичное описание, Контактный email/телефон.
Действие: Выбор базовой валюты (связь с Currencies).
Шаг 2: Выбор модели управления остатками
Интерфейс выбора из двух карточек:
Карточка А: "Google Таблица" (Быстрый старт, внешнее управление).
Карточка Б: "Мой склад" (Учет в системе, импорт файлов, расширенная аналитика).
Ветка А: Интеграция с Google Sheets
Шаг А.1: Подключение. Поле ввода публичной ссылки на Google таблицу.
Шаг А.2: Маппинг полей (Mapping). Интерфейс сопоставления колонок таблицы (например, "Колонка А" -> SKU, "Колонка B" -> Цена).
Результат: В Tenant сохраняется JSON-конфигурация подключения. Включается фича remote_search.
Ветка Б: Настройка локального склада
Шаг Б.1: Создание склада. Упрощенная форма создания первого Warehouse (Название, Город).
Шаг Б.2: Импорт остатков. Drag-and-drop зона для Excel-файла.
Логика: Используется существующий флоу /import-stocks с парсингом через XLSX и валидацией Zod.
Результат: Создание записей в коллекциях Products и Stocks.
4. Техническая реализация
Пути и маршруты (App Router)
src/app/(frontend)/(private)/onboarding/page.tsx — Главный контейнер визарда.
src/widgets/onboarding/ — Компоненты шагов (StepProfile, StepMode, StepGoogle, StepImport).
Состояние и API (tRPC)
State: Использование Zustand для хранения данных между шагами до финальной отправки.
Procedures:
onboarding.updateProfile (в entities/tenants)
onboarding.connectGoogleSheets (в entities/remote-stock)
onboarding.complete (финализация процесса, снятие флага "new-user").
Интеграция с Google Sheets
Использование сервисного аккаунта или API ключа на бэкенде для чтения публичных таблиц.
Кеширование данных из таблиц (например, на 1 час) для обеспечения скорости поиска.
5. Критерии готовности (Definition of Done)
Поставщик может пройти путь от регистрации до появления товаров в поиске за < 3 минут.
После завершения онбординга в Tenant проставляется флаг isOnboarded: true.
Поставщик видит превью своего публичного каталога в конце процесса.
